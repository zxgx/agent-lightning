{
  "annotations": {
    "list": []
  },
  "editable": true,
  "gnetId": null,
  "graphTooltip": 0,
  "id": null,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 100,
      "panels": [],
      "title": "LightningStore HTTP API",
      "type": "row"
    },
    {
      "fieldConfig": {
        "defaults": {
          "unit": "ops/s"
        }
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 1
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "expr": "sum by (method, path) (rate(agl_http_total[15s]))",
          "legendFormat": "{{method}} {{path}}"
        }
      ],
      "title": "HTTP Requests / Sec (by Path)",
      "type": "timeseries"
    },
    {
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        }
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 1
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum by (le) (rate(agl_http_latency_bucket[15s])))",
          "legendFormat": "P50"
        },
        {
          "expr": "histogram_quantile(0.95, sum by (le) (rate(agl_http_latency_bucket[15s])))",
          "legendFormat": "P95"
        },
        {
          "expr": "histogram_quantile(0.99, sum by (le) (rate(agl_http_latency_bucket[15s])))",
          "legendFormat": "P99"
        }
      ],
      "title": "HTTP Latency (P50, P95, P99)",
      "type": "timeseries"
    },
    {
      "fieldConfig": {
        "defaults": {
          "unit": "ops/s"
        }
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 1
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "expr": "sum by (method, path, status) (rate(agl_http_total{status!~\"2..\"}[15s]))",
          "legendFormat": "{{method}} {{path}} {{status}}"
        }
      ],
      "title": "HTTP Errors / Sec (non-2xx)",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 9
      },
      "id": 200,
      "panels": [],
      "title": "LightningStore RPC Metrics",
      "type": "row"
    },
    {
      "fieldConfig": {
        "defaults": {
          "unit": "ops/s"
        }
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 0,
        "y": 10
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "expr": "sum by (method) (rate(agl_store_total[15s]))",
          "legendFormat": "{{method}}"
        }
      ],
      "title": "Store Calls / Sec (by Method)",
      "type": "timeseries"
    },
    {
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        }
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 8,
        "y": 10
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum by (le) (rate(agl_store_latency_bucket[15s])))",
          "legendFormat": "P50"
        },
        {
          "expr": "histogram_quantile(0.95, sum by (le) (rate(agl_store_latency_bucket[15s])))",
          "legendFormat": "P95"
        },
        {
          "expr": "histogram_quantile(0.99, sum by (le) (rate(agl_store_latency_bucket[15s])))",
          "legendFormat": "P99"
        }
      ],
      "title": "Store Latency (P50, P95, P99)",
      "type": "timeseries"
    },
    {
      "fieldConfig": {
        "defaults": {
          "unit": "ops/s"
        }
      },
      "gridPos": {
        "h": 8,
        "w": 8,
        "x": 16,
        "y": 10
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "expr": "sum by (method, status) (rate(agl_store_total{status!=\"OK\"}[15s]))",
          "legendFormat": "{{method}} {{status}}"
        }
      ],
      "title": "Store Errors / Sec (by Method)",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 18
      },
      "id": 300,
      "panels": [],
      "title": "Collection Metrics",
      "type": "row"
    },
    {
      "fieldConfig": {
        "defaults": {
          "unit": "ops/s"
        }
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 19
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "expr": "sum by (store_method, operation) (rate(agl_collections_total[15s]))",
          "legendFormat": "{{store_method}} {{operation}}"
        }
      ],
      "title": "Collection Ops / Sec (by Store Method)",
      "type": "timeseries"
    },
    {
      "fieldConfig": {
        "defaults": {
          "unit": "ops/s"
        }
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 19
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "expr": "sum by (store_method, collection, status) (rate(agl_collections_total{status!=\"OK\"}[15s]))",
          "legendFormat": "{{store_method}} {{collection}} {{status}}"
        }
      ],
      "title": "Collection Errors / Sec",
      "type": "timeseries"
    },
    {
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        }
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 27
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum by (le) (rate(agl_collections_latency_bucket[15s])))",
          "legendFormat": "P50"
        },
        {
          "expr": "histogram_quantile(0.95, sum by (le) (rate(agl_collections_latency_bucket[15s])))",
          "legendFormat": "P95"
        },
        {
          "expr": "histogram_quantile(0.99, sum by (le) (rate(agl_collections_latency_bucket[15s])))",
          "legendFormat": "P99"
        }
      ],
      "title": "Collection Latency (P50, P95, P99)",
      "type": "timeseries"
    },
    {
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        }
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 27
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum by (le, store_method) (rate(agl_collections_latency_bucket[15s])))",
          "legendFormat": "{{store_method}}"
        }
      ],
      "title": "Collection Latency P95 (by Store Method)",
      "type": "timeseries"
    },
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 35
      },
      "id": 400,
      "panels": [],
      "title": "Rollout Outcomes",
      "type": "row"
    },
    {
      "fieldConfig": {
        "defaults": {
          "unit": "ops/s"
        }
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 36
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "expr": "sum by (status) (rate(agl_rollouts_total[15s]))",
          "legendFormat": "{{status}}"
        }
      ],
      "title": "Rollout Completion Rate (by Status)",
      "type": "timeseries"
    },
    {
      "fieldConfig": {
        "defaults": {
          "unit": "ops/s"
        }
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 36
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "expr": "sum by (mode) (rate(agl_rollouts_total[15s]))",
          "legendFormat": "{{mode}}"
        }
      ],
      "title": "Rollout Completion Rate (by Mode)",
      "type": "timeseries"
    },
    {
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        }
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 44
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.50, sum by (le) (rate(agl_rollouts_duration_bucket[15s])))",
          "legendFormat": "P50"
        },
        {
          "expr": "histogram_quantile(0.95, sum by (le) (rate(agl_rollouts_duration_bucket[15s])))",
          "legendFormat": "P95"
        },
        {
          "expr": "histogram_quantile(0.99, sum by (le) (rate(agl_rollouts_duration_bucket[15s])))",
          "legendFormat": "P99"
        }
      ],
      "title": "Rollout Duration (P50, P95, P99)",
      "type": "timeseries"
    },
    {
      "fieldConfig": {
        "defaults": {
          "unit": "s"
        }
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 44
      },
      "options": {
        "legend": {
          "displayMode": "list",
          "placement": "bottom"
        },
        "tooltip": {
          "mode": "single"
        }
      },
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum by (le, status) (rate(agl_rollouts_duration_bucket[15s])))",
          "legendFormat": "{{status}}"
        }
      ],
      "title": "Rollout Duration P95 (by Status)",
      "type": "timeseries"
    }
  ],
  "schemaVersion": 36,
  "style": "dark",
  "tags": [
    "agentlightning"
  ],
  "templating": {
    "list": []
  },
  "time": {
    "from": "now-10m",
    "to": "now"
  },
  "title": "Agent Lightning Metrics",
  "version": 2
}
